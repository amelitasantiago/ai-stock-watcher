<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Night's Watch ‚Äî AI Stock Watcher</title>
  <link rel="stylesheet" href="./nightwatch.css?v=5" />
  <!-- Chart.js for sparklines & equity -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="icon" href="./favicon.ico" sizes="any">  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: radial-gradient(1000px 600px at 10% 0%, #0b1221 0%, #060a13 40%, #03060d 100%); }
    .glass { background: linear-gradient(180deg, rgba(17,24,39,0.6), rgba(17,24,39,0.4)); border: 1px solid rgba(255,255,255,0.06); }
    .tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 999px; }
    .tag-bull { background: rgba(16,185,129,0.12); color: #34d399; box-shadow: 0 0 12px rgba(16,185,129,0.25); }
    .tag-bear { background: rgba(239,68,68,0.12); color: #f87171; box-shadow: 0 0 12px rgba(239,68,68,0.25); }
    .tag-neutral { background: rgba(148,163,184,0.12); color: #cbd5e1; box-shadow: 0 0 10px rgba(148,163,184,0.2); }
    .pill { padding: 8px 12px; border-radius: 999px; }
    .card { border-radius: 16px; transition: transform .2s ease, box-shadow .2s ease; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 12px 50px rgba(0,0,0,0.35); }
    .shadow-soft { box-shadow: 0 4px 40px rgba(0,0,0,0.25); }
    .glow-up { color: #22c55e; text-shadow: 0 0 12px rgba(34,197,94,0.55); }
    .glow-down { color: #ef4444; text-shadow: 0 0 12px rgba(239,68,68,0.55); }
    
    /* Stock Cards Grid */
    .cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    @media (max-width: 1024px) {
      .cards {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 640px) {
      .cards {
        grid-template-columns: 1fr;
      }
    }
    
    .content {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    /* News mini list in overview */
    .news-mini .news-item {
      display: block;
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      text-decoration: none;
      transition: background 0.2s;
    }
    .news-mini .news-item:hover {
      background: rgba(255, 255, 255, 0.02);
    }
    .news-mini .news-item:last-child {
      border-bottom: none;
    }
    .news-title {
      color: #e2e8f0;
      font-size: 0.9rem;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .news-meta {
      color: #64748b;
      font-size: 0.8rem;
      display: flex;
      gap: 12px;
    }
    .news-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      display: inline-block;
    }
    .news-dot.positive, .news-dot.bullish {
      background: #10b981;
    }
    .news-dot.negative, .news-dot.bearish {
      background: #ef4444;
    }
    .news-dot.neutral {
      background: #94a3b8;
    }
    
    /* Model Performance Table */
    .metrics tbody tr {
      transition: background 0.2s;
    }
    .metrics tbody tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }
    
    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(251, 191, 36, 0.1);
      border-top-color: #fbbf24;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(6, 10, 19, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      border-radius: 16px;
    }
    
    .loading-text {
      margin-top: 16px;
      color: #fbbf24;
      font-weight: 600;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #94a3b8;
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-state-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #e2e8f0;
      margin-bottom: 8px;
    }
    
    .empty-state-text {
      font-size: 1rem;
      line-height: 1.6;
    }
    
    /* Card Animations */
    .watch-card {
      animation: slideUp 0.4s ease-out backwards;
    }
    
    .watch-card:nth-child(1) { animation-delay: 0.05s; }
    .watch-card:nth-child(2) { animation-delay: 0.1s; }
    .watch-card:nth-child(3) { animation-delay: 0.15s; }
    .watch-card:nth-child(4) { animation-delay: 0.2s; }
    .watch-card:nth-child(5) { animation-delay: 0.25s; }
    .watch-card:nth-child(6) { animation-delay: 0.3s; }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Tooltip */
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      border-bottom: 1px dashed rgba(251, 191, 36, 0.5);
      color: #fbbf24;
    }
    
    .tooltip:hover::after {
      content: attr(data-tip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 12px;
      background: rgba(17, 24, 39, 0.95);
      color: #e2e8f0;
      border: 1px solid rgba(251, 191, 36, 0.3);
      border-radius: 6px;
      white-space: nowrap;
      font-size: 0.875rem;
      font-weight: 400;
      z-index: 1000;
      margin-bottom: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }
    
    .tooltip:hover::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: rgba(251, 191, 36, 0.3);
      margin-bottom: 2px;
    }
    
    /* Pulse Animation for Loading States */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.03) 75%);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
      border-radius: 8px;
    }
    
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Pulse animation for live indicator */
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.5;
        transform: scale(1.1);
      }
    }
    
    /* Slide in from left animation */
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    /* Real-time widget responsive */
    @media (max-width: 768px) {
      #realtimeWidget {
        bottom: 70px;
        left: 10px;
        padding: 10px 12px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body class="text-slate-200">
  <header class="hero">
    <div class="hero-inner text-center">
      <!-- Ancient AI Wisdom Badge -->
      <div style="margin-bottom: 20px;">
        <span style="display: inline-flex; align-items: center; gap: 8px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); padding: 6px 16px; border-radius: 20px; font-size: 0.875rem; color: #fbbf24;">
          <span>üß†</span>
          <span>Ancient AI Wisdom</span>
        </span>
      </div>

      <h1 style="display: flex; align-items: center; justify-content: center; gap: 16px; font-size: 3rem; font-weight: 700; margin-bottom: 16px; color: white;">
        <span>üè∞</span>
        <span>The Night's Watch</span>
        <span>‚öîÔ∏è</span>
      </h1>

      <p style="font-size: 1.125rem; color: #94a3b8; max-width: 700px; margin: 0 auto 32px; line-height: 1.6;">
        Vigilant guardians of the market realm, keeping eternal watch<br />
        over the realm's treasures with ancient wisdom
      </p>

      <!-- Model Strip 
      <div id="modelStrip" class="model-strip" style="display: flex; gap: 12px; justify-content: center; margin-bottom: 32px; flex-wrap: wrap;">
        <img src="/img/model-vader.png" alt="VADER" title="VADER" style="width: 60px; height: 80px; object-fit: contain; opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
        <img src="/img/model-finbert.png" alt="FinBERT" title="FinBERT" style="width: 60px; height: 80px; object-fit: contain; opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
        <img src="/img/model-arima.png" alt="ARIMA" title="ARIMA" style="width: 60px; height: 80px; object-fit: contain; opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
        <img src="/img/model-lstm.png" alt="LSTM Hybrid" title="LSTM Hybrid" style="width: 60px; height: 80px; object-fit: contain; opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
        <img src="/img/model-bayesianridge.png" alt="Bayesian Ridge" title="Bayesian Ridge" style="width: 60px; height: 80px; object-fit: contain; opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
        <img src="/img/model-bayesianinf.png" alt="Bayesian Inf." title="Bayesian Inference" style="width: 60px; height: 80px; object-fit: contain; opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
        <img src="/img/model-rules-fuzzy.png" alt="Rules + Fuzzy" title="Rules + Fuzzy Logic" style="width: 60px; height: 80px; object-fit: contain; opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
      </div>

      <p class="sub">Vigilant guardians wielding ensemble forecasts and sentiment analysis to guard the realm's treasures.</p> -->

      <div class="hero-cta" style="display: flex; gap: 12px; justify-content: center; margin-bottom: 24px;">
        <button id="beginBtn" style="display: flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #1a1a1a; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: transform 0.2s;"
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(251, 191, 36, 0.3)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
          <span>‚ö°</span>
          <span>Begin the Watch</span>
        </button>
        <button id="chartsBtn" style="display: flex; align-items: center; gap: 8px; background: rgba(255, 255, 255, 0.05); color: #e2e8f0; border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: all 0.2s;"
        onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'; this.style.borderColor='rgba(255, 255, 255, 0.2)'"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.borderColor='rgba(255, 255, 255, 0.1)'">
          <span>üìä</span>
          <span>Ancient Charts</span>
        </button>
      </div>

      <div class="hero-search" style="max-width: 600px; margin: 0 auto;">
        <div style="position: relative;">
          <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #64748b; font-size: 1.125rem;">üîç</span>
          <input id="searchBox" placeholder="Seek holdings to watch (e.g., AAPL, Tesla)‚Ä¶" style="width: 100%; padding: 14px 16px 14px 48px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #e2e8f0; font-size: 1rem; outline: none; transition: all 0.2s;" 
          onfocus="this.style.background='rgba(255, 255, 255, 0.08)'; this.style.borderColor='rgba(251, 191, 36, 0.3)'"
          onblur="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.borderColor='rgba(255, 255, 255, 0.1)'" />
        </div>
      </div>
    </div>
  </header>

  <!-- Summary KPIs -->
  <section class="grid kpis" style="grid-template-columns: repeat(4, 1fr); gap: 16px; max-width: 1200px; margin: 32px auto; padding: 0 20px;">
    <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 16px; padding: 20px; transition: transform 0.2s;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
        <span style="font-size: 1.5rem;">üí∞</span>
        <div style="font-size: 0.875rem; color: #94a3b8; font-weight: 500;">Realm's Treasure</div>
      </div>
      <div id="sumTreasure" style="font-size: 1.75rem; font-weight: 700; color: white;">$‚Äî</div>
    </div>
    <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 16px; padding: 20px; transition: transform 0.2s;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
        <span style="font-size: 1.5rem;">üìà</span>
        <div style="font-size: 0.875rem; color: #94a3b8; font-weight: 500;">Fortune's Change</div>
      </div>
      <div id="sumChange" style="font-size: 1.75rem; font-weight: 700; color: white;">‚Äî</div>
    </div>
    <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 16px; padding: 20px; transition: transform 0.2s;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
        <span style="font-size: 1.5rem;">üåä</span>
        <div style="font-size: 0.875rem; color: #94a3b8; font-weight: 500;">The Winds</div>
      </div>
      <div id="sumWinds" style="font-size: 1.75rem; font-weight: 700; color: white;">‚Äî</div>
    </div>
    <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 16px; padding: 20px; transition: transform 0.2s;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
        <span style="font-size: 1.5rem;">üëÅÔ∏è</span>
        <div style="font-size: 0.875rem; color: #94a3b8; font-weight: 500;">Under Watch</div>
      </div>
      <div id="sumCount" style="font-size: 1.75rem; font-weight: 700; color: white;">‚Äî Holdings</div>
    </div>
  </section>

  <!-- Watchlist -->
  <main class="content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
      <div>
        <h2 style="display: flex; align-items: center; gap: 12px; font-size: 1.75rem; font-weight: 700; margin: 0 0 8px 0; color: white;">
          <span>üõ°Ô∏è</span>
          <span>Your Watch</span>
          <span>üëÅÔ∏è</span>
        </h2>
        <p style="margin: 0; color: #94a3b8; font-size: 0.95rem;">Guard the realm's treasures with ancient wisdom and vigilant eyes üëÅÔ∏è</p>
      </div>
      <div style="display: flex; align-items: center; gap: 8px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); padding: 8px 16px; border-radius: 20px;">
        <span style="color: #fbbf24;">‚≠ê</span>
        <span id="watchedCount" style="color: #fbbf24; font-weight: 600;">6 Watched</span>
        <span style="color: #fbbf24;">üëÅÔ∏è</span>
      </div>
    </div>
    <div id="cards" class="cards"></div>

    <!-- Your Trade Plans (single instance) -->
    <section id="plansPanel" class="panel mt-8" style="max-width:1160px;margin:12px auto">
      <div class="panel-title">Your Trade Plans</div>
      <div id="plansList" class="strategies-list">
        <div class="empty muted">No saved trade plans yet.</div>
      </div>
    </section>

    <!-- Portfolio Tracker -->
    <section id="portfolioPanel" class="panel mt-8" style="max-width:1160px;margin:12px auto">
      <div class="panel-title" style="display: flex; align-items: center; justify-content: space-between;">
        <span>üìä Active Positions</span>
        <span style="font-size: 0.875rem; color: #64748b; font-weight: 400;">Live P&L Tracking</span>
      </div>
      <div id="portfolioContainer"></div>
    </section>
  </main>

  <!-- Drawer -->
  <section id="detailDrawer" class="drawer" aria-hidden="true">
    <div class="sheet">
      <div class="sheet-hdr" style="position: relative;">
        <div class="title">
          <strong id="drawerTitle">TICKER</strong>
          <span id="drawerSentMini" class="muted" style="margin-left:8px"></span>
        </div>
        <button id="drawerClose" style="position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s;"
        onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">Close</button>
      </div>

      <div class="tabbar">
        <button class="active" data-tab="overview" onclick="switchTab('overview')">Overview</button>
        <button data-tab="news" onclick="switchTab('news')">News</button>
        <button data-tab="plan" onclick="switchTab('plan')">Trade Plan</button>
      </div>

      <!-- Overview -->
      <div id="tab-overview" class="tab-panel" style="display:block">

        <!-- Top Performance Metrics Row -->
        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 20px;">
          <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 16px; text-align: center;">
            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">
              <span class="tooltip" data-tip="Total cumulative return over entire period">Total</span>
            </div>
            <div id="kpiTotal" style="font-size: 1.5rem; font-weight: 700; color: white;">‚Äî</div>
          </div>
          <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 16px; text-align: center;">
            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">
              <span class="tooltip" data-tip="Compound Annual Growth Rate - annualized return">CAGR</span>
            </div>
            <div id="kpiCAGR" style="font-size: 1.5rem; font-weight: 700; color: white;">‚Äî</div>
          </div>
          <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 16px; text-align: center;">
            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">
              <span class="tooltip" data-tip="Risk-adjusted return measure (higher is better)">Sharpe</span>
            </div>
            <div id="kpiSharpeTop" style="font-size: 1.5rem; font-weight: 700; color: white;">‚Äî</div>
          </div>
          <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 16px; text-align: center;">
            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">
              <span class="tooltip" data-tip="Maximum peak-to-trough decline">MaxDD</span>
            </div>
            <div id="kpiMaxDDTop" style="font-size: 1.5rem; font-weight: 700; color: #ef4444;">‚Äî</div>
          </div>
          <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 16px; text-align: center;">
            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">
              <span class="tooltip" data-tip="Number of trading periods analyzed">Periods</span>
            </div>
            <div id="kpiPeriods" style="font-size: 1.5rem; font-weight: 700; color: white;">‚Äî</div>
          </div>
        </div>

        <!-- Ancient AI Wisdom with Enhanced Layout -->
        <div class="panel" style="margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div class="panel-title">Ancient AI Wisdom üßô‚Äç‚ôÄÔ∏è</div>
            <div id="signalBadge" style="background: rgba(100, 116, 139, 0.2); color: #94a3b8; padding: 6px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem;">HOLD</div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 16px;">
            <!-- Left: Confidence -->
            <div>
              <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 8px;">Confidence Level</div>
              <div style="height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; margin-bottom: 8px; overflow: hidden;">
                <div id="wisdomConfBar2" style="height: 100%; background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%); width: 0%; transition: width 0.3s;"></div>
              </div>
              <div id="wisdomPct" style="font-size: 2rem; font-weight: 700; color: white; margin-bottom: 8px;">‚Äî</div>
              <div id="wisdomMeta2" style="font-size: 0.875rem; color: #64748b;">‚Äî</div>
            </div>

            <!-- Right: Target Price -->
            <div>
              <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 8px;">Target Price</div>
              <div id="targetPrice" style="font-size: 2.5rem; font-weight: 700; color: #10b981; margin-bottom: 4px;">$‚Äî</div>
              <div style="display: flex; gap: 12px; font-size: 0.9rem; color: #94a3b8;">
                <span>Now <span id="currentPrice" style="color: white;">$‚Äî</span></span>
                <span>‚Ä¢ Exp. <span id="expectedChange" style="color: #10b981;">‚Äî</span></span>
              </div>
            </div>
          </div>

          <div class="panel-subtitle" style="margin-top: 16px; margin-bottom: 8px;">The Maester's Analysis üìú</div>
          <div id="maesterText" style="line-height: 1.6; color: #94a3b8; margin-bottom: 16px;">‚Äî</div>

          <div class="btn-row" style="margin-top: 12px;">
            <button id="btnAttack" class="btn attack">Attack ‚öîÔ∏è</button>
            <button id="btnDefend" class="btn defend">Defend üõ°Ô∏è</button>
            <button id="btnRetreat" class="btn retreat">Retreat üëë</button>
          </div>
        </div>

        <!-- Sentiment Chart -->
        <div class="panel" style="margin-bottom: 20px;">
          <div class="panel-title">Sentiment (compound)</div>
          <div style="height: 160px;"><canvas id="sentChart"></canvas></div>
        </div>

        <!-- Model Performance Table -->
        <div class="panel" style="margin-bottom: 20px;">
          <div class="panel-title">Model Performance</div>
          <table class="metrics" style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <th style="text-align: left; padding: 12px; color: #94a3b8; font-weight: 600; font-size: 0.875rem;">Model</th>
                <th style="text-align: right; padding: 12px; color: #94a3b8; font-weight: 600; font-size: 0.875rem;">RMSE</th>
                <th style="text-align: right; padding: 12px; color: #94a3b8; font-weight: 600; font-size: 0.875rem;">MAE</th>
                <th style="text-align: right; padding: 12px; color: #94a3b8; font-weight: 600; font-size: 0.875rem;">Hit Rate</th>
                <th style="text-align: right; padding: 12px; color: #94a3b8; font-weight: 600; font-size: 0.875rem;">n</th>
              </tr>
            </thead>
            <tbody id="modelsTable">
              <tr><td colspan="5" style="text-align: center; padding: 20px; color: #64748b;">‚Äî</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Realm's Whispers -->
        <div class="panel">
          <div class="panel-title">Realm's Whispers <span style="color: #64748b; font-weight: 400;">(6)</span></div>
          <div id="newsListOverview" class="news-mini"></div>
        </div>

      </div>

      <!-- News -->
      <div id="tab-news" class="tab-panel" style="display:none">
        <div class="panel">
          <div class="panel-title">Latest Headlines</div>
          <div id="newsList"></div>
        </div>
      </div>

      <!-- Trade Plan -->
      <div id="tab-plan" class="tab-panel" style="display:none">
        <div class="panel">
          <div class="panel-title">Ancient AI Wisdom üßô‚Äç‚ôÄÔ∏è</div>
          <div class="muted" style="margin-bottom:8px">Confidence <span id="wisdomConfVal">‚Äî</span></div>
          <div class="progress"><div id="wisdomConfBar" class="bar" style="width:45%"></div></div>
          <div id="wisdomMeta" class="muted" style="margin-top:8px"></div>

          <div class="btn-row" style="margin-top:12px">
            <button id="btnAttackPlan" class="btn attack">Attack ‚öîÔ∏è</button>
            <button id="btnDefendPlan" class="btn defend">Defend üõ°Ô∏è</button>
            <button id="btnRetreatPlan" class="btn retreat">Retreat üëë</button>
          </div>

          <label class="muted" style="margin-top:12px;display:block; margin-bottom: 6px;">Trade Plan Notes</label>
          <textarea id="planNote" rows="4" placeholder="Why? catalysts, risks, stop/TP ‚Ä¶" style="
            width: 100%;
            padding: 12px;
            background: rgba(17, 24, 39, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.95rem;
            font-family: inherit;
            line-height: 1.5;
            resize: vertical;
            transition: all 0.2s;
          " 
          onfocus="this.style.borderColor='rgba(251, 191, 36, 0.5)'; this.style.background='rgba(17, 24, 39, 0.8)'"
          onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'; this.style.background='rgba(17, 24, 39, 0.6)'"
          ></textarea>
        </div>
      </div>
    </div>
  </section>

  <script src="./app.js?v=7"></script>

  <!-- Real-Time Status Widget (Fixed Bottom-Left) -->
  <div id="realtimeWidget" style="position: fixed; bottom: 20px; left: 20px; background: rgba(17, 24, 39, 0.95); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 12px 16px; z-index: 100; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); animation: slideInLeft 0.4s ease-out;">
    <div style="display: flex; flex-direction: column; gap: 10px; font-size: 0.875rem;">
      <!-- Live Indicator + Timestamp -->
      <div style="display: flex; align-items: center; gap: 12px;">
        <div id="liveIndicator" style="display: flex; align-items: center; font-weight: 600; color: #10b981;">
          <span style="display: inline-block; width: 8px; height: 8px; background: #10b981; border-radius: 50%; margin-right: 6px; animation: pulse 2s infinite;"></span>LIVE
        </div>
        <div id="lastUpdate" style="color: #94a3b8; font-size: 0.8rem;">
          Last: --:--:--
        </div>
      </div>
      
      <!-- Refresh Button + Auto Toggle -->
      <div style="display: flex; align-items: center; gap: 10px;">
        <button id="refreshBtn" style="flex: 1; padding: 6px 12px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); color: #fbbf24; font-weight: 500; border-radius: 6px; cursor: pointer; font-size: 0.875rem; transition: all 0.2s; white-space: nowrap;"
        onmouseover="this.style.background='rgba(251, 191, 36, 0.2)'; this.style.transform='translateY(-1px)'"
        onmouseout="this.style.background='rgba(251, 191, 36, 0.1)'; this.style.transform='translateY(0)'">
          ‚ü≥ Refresh
        </button>
        <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; color: #94a3b8; font-size: 0.75rem; line-height: 1.2;">
          <input type="checkbox" id="autoRefreshToggle" checked style="cursor: pointer;">
          <span>Auto<br/>(60s)</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Helper -->
  <button onclick="showKeyboardHelp()" style="position: fixed; bottom: 110px; left: 20px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(251, 191, 36, 0.3); color: #fbbf24; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 500; z-index: 100; display: flex; align-items: center; gap: 8px; transition: all 0.2s;"
  onmouseover="this.style.background='rgba(17, 24, 39, 0.95)'; this.style.transform='translateY(-2px)'"
  onmouseout="this.style.background='rgba(17, 24, 39, 0.8)'; this.style.transform='translateY(0)'">
    <span>‚å®Ô∏è</span>
    <span>Shortcuts</span>
  </button>

  <!-- Ancient Charts Modal -->
  <section id="chartsModal" class="drawer" aria-hidden="true" style="z-index: 1000;">
    <div class="sheet" style="max-width: 1400px; width: 95%;">
      <div class="sheet-hdr">
        <div class="title" style="display: flex; align-items: center; gap: 12px;">
          <span style="font-size: 1.5rem;">üìä</span>
          <strong id="chartTitle">The Seer's Chart</strong>
        </div>
        <div style="display: flex; gap: 12px; align-items: center;">
          <div style="display: flex; gap: 8px; background: rgba(255, 255, 255, 0.05); padding: 4px; border-radius: 8px;">
            <button id="btnHistorical" class="chart-toggle active" onclick="switchChartMode('historical')">
              <span>üìä</span> Historical
            </button>
            <button id="btnForecast" class="chart-toggle" onclick="switchChartMode('forecast')">
              <span>üîÆ</span> Forecast
            </button>
          </div>
          <button id="chartsClose" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s;"
          onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'"
          onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">Close</button>
        </div>
      </div>

      <!-- Chart Canvas -->
      <div style="padding: 24px; background: rgba(17, 24, 39, 0.4); border-radius: 12px; margin: 20px;">
        <div style="height: 400px; position: relative;">
          <canvas id="seersChart"></canvas>
        </div>
      </div>

      <!-- Metrics Row -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px; padding: 0 20px;">
        <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 20px; text-align: center;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px; color: #94a3b8; font-size: 0.95rem;">
            <span>üéØ</span>
            <span>7-Day Target</span>
          </div>
          <div id="targetPrice" style="font-size: 2rem; font-weight: 700; color: #10b981;">$‚Äî</div>
        </div>
        
        <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 20px; text-align: center;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px; color: #94a3b8; font-size: 0.95rem;">
            <span>üîÆ</span>
            <span>Confidence</span>
          </div>
          <div id="confidence" style="font-size: 2rem; font-weight: 700; color: #a78bfa;">‚Äî%</div>
        </div>
        
        <div style="background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 20px; text-align: center;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px; color: #94a3b8; font-size: 0.95rem;">
            <span>‚ö°</span>
            <span>Volatility</span>
          </div>
          <div id="volatility" style="font-size: 2rem; font-weight: 700; color: #fbbf24;">¬±‚Äî%</div>
        </div>
      </div>
    </div>
  </section>

  <style>
    .chart-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      background: transparent;
      border: none;
      color: #94a3b8;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    .chart-toggle.active {
      background: rgba(251, 191, 36, 0.15);
      color: #fbbf24;
    }
    .chart-toggle:hover:not(.active) {
      background: rgba(255, 255, 255, 0.05);
      color: #e2e8f0;
    }
    
    /* Action Buttons (Attack/Defend/Retreat) */
    .btn-row {
      display: flex;
      gap: 12px;
    }
    
    .btn-row button {
      flex: 1;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 600;
      border: 2px solid;
      background: transparent;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.95rem;
    }
    
    .btn-row button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .btn-row button:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .btn.attack {
      border-color: rgba(16, 185, 129, 0.5);
      color: #10b981;
    }
    
    .btn.attack:not(:disabled):hover {
      background: rgba(16, 185, 129, 0.1);
      border-color: #10b981;
    }
    
    .btn.defend {
      border-color: rgba(59, 130, 246, 0.5);
      color: #3b82f6;
    }
    
    .btn.defend:not(:disabled):hover {
      background: rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
    }
    
    .btn.retreat {
      border-color: rgba(239, 68, 68, 0.5);
      color: #ef4444;
    }
    
    .btn.retreat:not(:disabled):hover {
      background: rgba(239, 68, 68, 0.1);
      border-color: #ef4444;
    }
    
    /* Trade Plan Notes Textarea */
    #planNote::placeholder {
      color: #64748b;
      opacity: 1;
    }
    
    #planNote:focus::placeholder {
      color: #94a3b8;
    }
  </style>
</body>
</html>
